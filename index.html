<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>우리들의 비밀 채팅방</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background: #f0f2f5; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #chat-window { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        
        /* 메시지 스타일 */
        .message { 
            background: white; padding: 10px 15px; border-radius: 15px; 
            max-width: 80%; box-shadow: 0 1px 2px rgba(0,0,0,0.1); 
            word-break: break-all; line-height: 1.4; font-size: 15px;
        }
        
        /* 하단 입력창 */
        #input-area { background: white; padding: 15px; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        input { 
            flex: 1; padding: 12px 18px; border: 1px solid #ddd; 
            border-radius: 25px; outline: none; font-size: 15px;
        }
        input:focus { border-color: #0084ff; }
        button { 
            background: #0084ff; color: white; border: none; 
            padding: 0 20px; border-radius: 25px; cursor: pointer; 
            font-weight: bold; transition: 0.2s;
        }
        button:hover { background: #0073e6; }
    </style>
</head>
<body>

    <div id="chat-window">
        <div class="message" style="background: #e1f5fe; color: #01579b; align-self: center;">
            채팅방에 연결되었습니다! 대화를 시작해보세요.
        </div>
    </div>

    <div id="input-area">
        <input type="text" id="msg-input" placeholder="메시지를 입력하세요..." autocomplete="off">
        <button id="send-btn">전송</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        // 요청하신 Firebase 설정값 적용
        const firebaseConfig = {
            apiKey: "AIzaSyDVZVHumJQptb3P_sQT1yMAuVRhANI6Dj4",
            authDomain: "whiteboard-5e13d.firebaseapp.com",
            databaseURL: "https://whiteboard-5e13d-default-rtdb.firebaseio.com",
            projectId: "whiteboard-5e13d",
            storageBucket: "whiteboard-5e13d.firebasestorage.app",
            messagingSenderId: "665556862019",
            appId: "1:665556862019:web:c682afdb1cd13f3150c0f6",
            measurementId: "G-QS22EDDL9V"
        };

        // Firebase 초기화
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const chatRef = ref(db, 'chat_messages'); // 채팅 데이터를 저장할 경로

        const chatWindow = document.getElementById('chat-window');
        const msgInput = document.getElementById('msg-input');
        const sendBtn = document.getElementById('send-btn');

        // 메시지 전송 로직
        function sendMsg() {
            const text = msgInput.value.trim();
            if (text === "") return;

            // Firebase DB에 메시지 추가
            push(chatRef, {
                text: text,
                time: new Date().toLocaleTimeString()
            });

            msgInput.value = "";
            msgInput.focus();
        }

        // 버튼 클릭 및 엔터키 이벤트
        sendBtn.addEventListener('click', sendMsg);
        msgInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMsg();
        });

        // 데이터베이스에 새 메시지가 들어오면 화면에 표시
        onChildAdded(chatRef, (snapshot) => {
            const data = snapshot.val();
            displayMessage(data.text);
        });

        function displayMessage(text) {
            const msgDiv = document.createElement('div');
            msgDiv.classList.add('message');
            msgDiv.innerText = text;
            chatWindow.appendChild(msgDiv);
            
            // 새 메시지가 오면 화면을 아래로 자동 스크롤
            chatWindow.scrollTo({ top: chatWindow.scrollHeight, behavior: 'smooth' });
        }
    </script>
</body>
</html>
