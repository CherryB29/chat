<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>우리들의 실시간 화이트보드</title>
    <style>
        body { margin: 0; overflow: hidden; background: #f0f0f0; font-family: sans-serif; }
        canvas { display: block; background: white; cursor: crosshair; }
        .controls { 
            position: fixed; top: 20px; left: 20px; 
            background: rgba(255, 255, 255, 0.9); 
            padding: 15px; border-radius: 10px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 10;
        }
        button {
            padding: 8px 15px; background: #ff4757; color: white;
            border: none; border-radius: 5px; cursor: pointer; font-weight: bold;
        }
        button:hover { background: #ff6b81; }
    </style>
</head>
<body>

    <div class="controls">
        <button onclick="clearBoard()">모두 지우기</button>
        <p style="margin: 10px 0 0 0; font-size: 12px; color: #666;">
            링크를 공유하면 친구와 같이 그릴 수 있어요!
        </p>
    </div>

    <canvas id="whiteboard"></canvas>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, push, onChildAdded, remove } 
            from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        // 사용자가 제공한 Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyDVZVHumJQptb3P_sQT1yMAuVRhANI6Dj4",
            authDomain: "whiteboard-5e13d.firebaseapp.com",
            databaseURL: "https://whiteboard-5e13d-default-rtdb.firebaseio.com",
            projectId: "whiteboard-5e13d",
            storageBucket: "whiteboard-5e13d.firebasestorage.app",
            messagingSenderId: "665556862019",
            appId: "1:665556862019:web:c682afdb1cd13f3150c0f6",
            measurementId: "G-QS22EDDL9V"
        };

        // Firebase 초기화
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const drawingRef = ref(db, 'drawing');

        const canvas = document.getElementById('whiteboard');
        const ctx = canvas.getContext('2d');

        // 캔버스 크기 설정
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let isDrawing = false;

        // 마우스 이벤트 처리
        canvas.addEventListener('mousedown', () => { isDrawing = true; ctx.beginPath(); });
        canvas.addEventListener('mouseup', () => { isDrawing = false; });
        canvas.addEventListener('mousemove', (e) => {
            if (!isDrawing) return;

            const x = e.clientX;
            const y = e.clientY;

            // 1. Firebase에 좌표 저장 (다른 사람에게 전송)
            push(drawingRef, { x, y });
            
            // 2. 내 화면에 그리기
            draw(x, y);
        });

        // Firebase에서 실시간으로 데이터 받기
        onChildAdded(drawingRef, (snapshot) => {
            const data = snapshot.val();
            draw(data.x, data.y);
        });

        // 그리기 함수
        function draw(x, y) {
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#2f3542';

            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        // 전체 지우기 함수 (전역 범위로 설정)
        window.clearBoard = function() {
            if(confirm("정말 모든 그림을 지울까요?")) {
                remove(drawingRef); // DB 삭제
                ctx.clearRect(0, 0, canvas.width, canvas.height); // 내 화면 삭제
                location.reload(); // 동기화를 위해 새로고침
            }
        };
    </script>
</body>
</html>
